!--------------------------------------------------------------------------------

SUBROUTINE InitialiseSDDSFile(zOutFile,       &
                                    tFileType,      &
			            qOK)
!
!********************************************************************
! Initialise output files 
!********************************************************************
!
! zOutFile        - INPUT   - Output file name    
! tFileType       - OUTPUT  -File type properties
! qOK             - OUTPUT  - Error flag
!
!====================================================================
! Define local variables
!!
!=====================================================================
!	
      IMPLICIT NONE
      CHARACTER(*),   INTENT(IN)             :: zOutFile
      TYPE(cFileType),INTENT(INOUT)          :: tFileType
      LOGICAL,        INTENT(OUT)	     :: qOK      
!
!--------------------------------------------------------------------------------	
! Local Scalars         
!--------------------------------------------------------------------------------	
!
      LOGICAL                        :: qOKL
!
!--------------------------------------------------------------------------------	
! Set error flag to false         
!--------------------------------------------------------------------------------	
!
      qOK = .FALSE.
!
!--------------------------------------------------------------------------------	
! Open the file to receive output     
!! OpenFileForOutput subroutine starts on line 474 in this file   
!--------------------------------------------------------------------------------	
!
      call OpenFileForOutput(zOutFile,  &
      		    	     tFileType, &
			     qOKL)			  
      If (.NOT. qOKL) Goto 1000  
!
!--------------------------------------------------------------------------------	
! Write required header at the top of the file       
!--------------------------------------------------------------------------------	
! 
      call WriteSDDSHeader(tFileType,qOKL)
      If (.NOT. qOKL) Goto 1000  
!
!--------------------------------------------------------------------------------	
!  Set error flag and exit         
!--------------------------------------------------------------------------------	
!
      qOK = .TRUE.				    
      GoTo 2000     
!
!--------------------------------------------------------------------------------
! Error Handler
!--------------------------------------------------------------------------------
!            
1000 call Error_log('Error in DIO: InitialiseSDDSFile',tErrorLog_G)
   Print*,'Error in DIO: InitialiseSDDSFile'
2000 CONTINUE
      END SUBROUTINE InitialiseSDDSFile





!--------------------------------------------------------------------------------

      SUBROUTINE WriteSDDSHeader(tFileType,  &
                           qOK)
!
!********************************************************************
! Write SDDS file header
!********************************************************************
!
! tFileType - INPUT    - Properties of output file
! qOK       - OUTPUT   - Error flag
!
!====================================================================
! Define local variables
!!
!=====================================================================
!     
      IMPLICIT NONE
      TYPE(cFileType),INTENT(INOUT)           :: tFileType
      LOGICAL,       INTENT(OUT)          :: qOK      
!
!--------------------------------------------------------------------------------   
! Set error flag to false         
!--------------------------------------------------------------------------------   
!
      qOK = .FALSE.
!
!--------------------------------------------------------------------------------   
! Write SDDS header       
!--------------------------------------------------------------------------------   
!
      CALL SddsWriteVersion('1',tFileType)
!
!--------------------------------------------------------------------------------   
!  Set error flag and exit         
!--------------------------------------------------------------------------------   
!
      qOK = .TRUE.                            
      GoTo 2000     
!
!--------------------------------------------------------------------------------
! Error Handler
!--------------------------------------------------------------------------------
!            
1000 call Error_log('Error in DIO:  WriteSDDSHeader',tErrorLog_G)
   Print*,'Error in DIO: WriteSDDSHeader'
2000 CONTINUE     

      END SUBROUTINE WriteSDDSHeader 
!--------------------------------------------------------------------------------
!--------------------------------------------------------------------------------

      SUBROUTINE WriteSDDSNewPage(tFileType,  &
                            qOK)
!
!********************************************************************
! Write SDDS page number
!********************************************************************
!
! tFileType - INPUT    - Properties of output file
! qOK       - OUTPUT   - Error flag
!
!====================================================================
! Define local variables
!!
!=====================================================================
!     
      IMPLICIT NONE
      TYPE(cFileType),INTENT(INOUT)           :: tFileType
      LOGICAL,        INTENT(OUT)         :: qOK      
 !
!--------------------------------------------------------------------------------   
! Set error flag to false         
!--------------------------------------------------------------------------------   
!
      qOK = .FALSE.
!
!--------------------------------------------------------------------------------   
! Increase page number count         
!--------------------------------------------------------------------------------   
!
      tFileType%iPage = tFileType%iPage + 1_IP
!
!--------------------------------------------------------------------------------   
! Write SDDS header       
!--------------------------------------------------------------------------------   
!
      If (tFileType%qFormatted) Then
         CALL SddsWritePage(tFileType%iPage,tFileType)
      End If
!
!--------------------------------------------------------------------------------   
!  Set error flag and exit         
!--------------------------------------------------------------------------------   
!
      qOK = .TRUE.                            
      GoTo 2000     
!
!--------------------------------------------------------------------------------
! Error Handler
!--------------------------------------------------------------------------------
!            
1000 call Error_log('Error in DIO:  WriteSDDSNewPage',tErrorLog_G)
   Print*,'Error in DIO: WriteSDDSNewPage'
2000 CONTINUE     


      END SUBROUTINE WriteSDDSNewPage
!--------------------------------------------------------------------------------